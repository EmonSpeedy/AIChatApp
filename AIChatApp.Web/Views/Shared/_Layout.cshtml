@using Microsoft.AspNetCore.Mvc.ViewFeatures
@using System.Text.Json
@{
    var successMessage = TempData["SuccessMessage"] as string;
    var warningMessage = TempData["WarningMessage"] as string;
}
<!DOCTYPE html>
<html lang="en" class="h-full">
<!-- ... inside <head> in _Layout.cshtml ... -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - AIChatApp</title>

    <!-- ADD THIS LINE HERE -->
    @RenderSection("HeadMeta", required: false)

    <!-- Only Local Tailwind Output -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <!-- Essential Icons and Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    @RenderSection("Styles", required: false)
</head>
<body class="text-slate-900 antialiased flex flex-col h-full bg-slate-50 font-['Inter']">

    <!-- Pure Tailwind Navbar -->
    <nav id="main-nav" class="sticky top-0 w-full z-50 bg-white border-b border-slate-100 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- Branding -->
                <div class="flex items-center">
                    <a asp-controller="Home" asp-action="Index" class="flex items-center gap-3 group">
                        <div class="w-9 h-9 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-100 group-hover:bg-indigo-700 transition-all">
                            <i class="fa-solid fa-share-nodes text-white text-sm"></i>
                        </div>
                        <span class="text-xl font-bold tracking-tight text-slate-900 uppercase">AIChatApp</span>
                    </a>
                </div>

                <!-- Spaced Nav Links -->
                <div class="hidden md:flex items-center space-x-10">
                    <a asp-controller="Home" asp-action="Index" class="text-sm font-semibold text-slate-600 hover:text-indigo-600 transition-colors">Home</a>
                    @if (User?.Identity?.IsAuthenticated ?? false)
                    {
                        <a asp-controller="Chat" asp-action="ChatList" class="text-sm font-semibold text-slate-600 hover:text-indigo-600 transition-colors">Chats</a>
                        <a asp-controller="UserList" asp-action="UsersList" class="text-sm font-semibold text-slate-600 hover:text-indigo-600 transition-colors">Find Users</a>
                    }
                    <a asp-controller="Home" asp-action="Privacy" class="text-sm font-semibold text-slate-600 hover:text-indigo-600 transition-colors">Privacy</a>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-5">
                    @if (User?.Identity?.IsAuthenticated ?? false)
                    {
                        <a asp-controller="Profile" asp-action="ProfileDetails" class="text-slate-500 hover:text-indigo-600 transition-transform hover:scale-110" title="My Profile">
                            <i class="fa-solid fa-circle-user text-2xl"></i>
                        </a>
                        <div class="h-5 w-px bg-slate-200"></div>
                        <form asp-controller="Auth" asp-action="Logout" method="post" id="logoutForm" class="m-0">
                            @Html.AntiForgeryToken()
                            <button type="button" onclick="confirmLogout(event)" class="text-slate-400 hover:text-rose-500 transition-colors">
                                <i class="fa-solid fa-right-from-bracket text-lg"></i>
                            </button>
                        </form>
                    }
                    else
                    {
                        <a asp-controller="Auth" asp-action="Login" class="text-sm font-bold text-slate-600 hover:text-indigo-600 transition-colors">Log in</a>
                        <a asp-controller="Auth" asp-action="Register" class="hidden sm:block bg-indigo-600 text-white px-6 py-2.5 rounded-xl text-sm font-bold hover:bg-indigo-700 hover:-translate-y-0.5 transition-all shadow-md shadow-indigo-100">
                            Register
                        </a>
                    }
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dynamic Content -->
    <main class="flex-grow">
        @RenderBody()
    </main>

    <!-- Emphasized Tailwind Footer -->
    <footer class="bg-white border-t border-slate-200 pt-16 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-y-12 md:gap-x-16 mb-16">
                <!-- Brand Column -->
                <div class="md:col-span-5">
                    <div class="flex items-center gap-2 mb-6">
                        <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-share-nodes text-white text-xs"></i>
                        </div>
                        <span class="text-xl font-black tracking-tighter text-slate-900 uppercase">AIChatApp</span>
                    </div>
                    <p class="text-slate-500 text-sm leading-relaxed mb-8 max-w-sm">
                        Revolutionizing digital communication with secure, intelligent, and real-time interaction tools for creators and teams worldwide.
                    </p>
                    <div class="flex">
                        <input type="email" placeholder="Your email address" class="w-full max-w-[240px] bg-slate-50 border border-slate-200 rounded-l-2xl px-5 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all" />
                        <button class="bg-slate-900 text-white px-6 py-3 rounded-r-2xl text-sm font-bold hover:bg-black transition-colors">Subscribe</button>
                    </div>
                </div>

                <!-- Links Grid -->
                <div class="md:col-span-7 grid grid-cols-2 sm:grid-cols-3 gap-8">
                    <div>
                        <h4 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-6">Platform</h4>
                        <ul class="space-y-4">
                            <li><a href="#" class="text-sm text-slate-500 hover:text-indigo-600 transition-colors">Features</a></li>
                            <li><a href="#" class="text-sm text-slate-500 hover:text-indigo-600 transition-colors">Mobile App</a></li>
                            <li><a href="#" class="text-sm text-slate-500 hover:text-indigo-600 transition-colors">Community</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-6">Company</h4>
                        <ul class="space-y-4">
                            <li><a href="#" class="text-sm text-slate-500 hover:text-indigo-600 transition-colors">Our Story</a></li>
                            <li><a href="#" class="text-sm text-slate-500 hover:text-indigo-600 transition-colors">Privacy</a></li>
                            <li><a href="#" class="text-sm text-slate-500 hover:text-indigo-600 transition-colors">Contact</a></li>
                        </ul>
                    </div>
                    <div class="col-span-2 sm:col-span-1">
                        <h4 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-6">Connect</h4>
                        <div class="flex gap-3">
                            <a href="#" class="w-10 h-10 rounded-xl bg-slate-50 flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all border border-transparent hover:border-indigo-100">
                                <i class="fa-brands fa-twitter"></i>
                            </a>
                            <a href="#" class="w-10 h-10 rounded-xl bg-slate-50 flex items-center justify-center text-slate-400 hover:text-slate-900 hover:bg-slate-100 transition-all border border-transparent hover:border-slate-200">
                                <i class="fa-brands fa-github"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="pt-8 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-6">
                <p class="text-[11px] text-slate-400 font-bold uppercase tracking-wider">
                    &copy; @DateTime.Now.Year AIChatApp Inc. • Made for the future
                </p>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 px-3 py-1 bg-green-50 border border-green-100 rounded-full">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-[10px] font-black text-green-600 uppercase">Live Systems</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Global Action Modal -->
    <div id="action-modal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="min-h-screen px-4 text-center flex items-center justify-center">
            <!-- Backdrop -->
            <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeActionModal()"></div>

            <!-- Modal Box -->
            <div id="modal-container" class="relative bg-white rounded-[2rem] shadow-2xl w-full max-w-sm p-10 transform transition-all border border-slate-100 scale-95 opacity-0 duration-300">

                <!-- Icon Container (ID matches site.js) -->
                <div id="modal-icon-container" class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-6 transition-colors duration-500">
                    <i id="modal-icon-element" class="fa-solid text-2xl"></i>
                </div>

                <h3 class="text-2xl font-bold text-slate-900" id="modal-title">Confirm</h3>
                <p id="modal-message-content" class="mt-3 text-sm text-slate-500 leading-relaxed font-medium"></p>

                <div class="mt-10 flex gap-4">
                    <!-- Cancel Button -->
                    <button id="modal-cancel-button" onclick="closeActionModal()" class="flex-1 py-4 bg-slate-50 text-slate-600 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-slate-100 transition-colors">
                        Cancel
                    </button>
                    <!-- Action Button -->
                    <button id="modal-action-button" class="flex-1 py-4 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-lg transition-all hover:scale-[1.02]">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        function confirmLogout(e) {
            const modal = document.getElementById('action-modal');
            document.getElementById('modal-title').innerText = "Sign Out";
            document.getElementById('modal-message-content').innerText = "You will need to re-authenticate to access your secured chats and profile.";
            modal.classList.remove('hidden');
            document.getElementById('modal-action-button').onclick = () => document.getElementById('logoutForm').submit();
        }

        function closeActionModal() {
            document.getElementById('action-modal').classList.add('hidden');
        }

        $(function() {
            const success = "@successMessage";
            const warning = "@warningMessage";
            if ((success || warning) && typeof showSimpleToast === 'function') {
                showSimpleToast(success ? "Success" : "Wait", success || warning, success ? "success" : "warning");
            }
        });
    </script>
    <script src="~/lib/signalr/signalr.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>